<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>UE-style draggable nodes with logs</title>
<style>
  body { margin: 0; background: #111; color: #eee; font-family: Arial, sans-serif; overflow: hidden; }
  #node-editor { width: 100vw; height: 100vh; background: #222; position: relative; overflow: hidden; }
  .node {
    position: absolute;
    background: #333;
    border: 2px solid #00ffff;
    border-radius: 6px;
    width: 160px;
    padding: 10px;
    box-sizing: border-box;
    color: #ccc;
    user-select: none;
    cursor: default;
  }
  .node-header {
    font-weight: bold;
    margin-bottom: 8px;
    color: #00ffff;
    border-bottom: 1px solid #00ffff;
    padding-bottom: 4px;
    cursor: grab;
  }
  .node-output, .node-input {
    height: 20px;
    background: #444;
    border-radius: 3px;
    margin: 5px 0;
    padding: 3px 6px;
    font-size: 0.9em;
  }
  svg {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: visible;
  }
  #log-window {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 360px;
    max-height: 120px;
    background: rgba(0,0,0,0.7);
    border: 1px solid #00ffff;
    border-radius: 6px;
    color: #00ffff;
    font-family: monospace;
    font-size: 12px;
    padding: 8px;
    overflow-y: auto;
    box-sizing: border-box;
    user-select: text;
    z-index: 1000;
  }
</style>
</head>
<body>

<div id="node-editor"></div>
<div id="log-window"></div>

<script>
  const editor = document.getElementById('node-editor');
  const logWindow = document.getElementById('log-window');

  function printLog(msg) {
    const time = new Date().toLocaleTimeString();
    logWindow.innerHTML += `[${time}] ${msg}<br>`;
    logWindow.scrollTop = logWindow.scrollHeight;
  }

  const nodesData = [
    { id: 'node1', title: 'Add', x: 50, y: 50, inputs: ['A', 'B'], outputs: ['Result'] },
    { id: 'node2', title: 'Multiply', x: 300, y: 150, inputs: ['X', 'Y'], outputs: ['Product'] },
    { id: 'node3', title: 'Output', x: 600, y: 100, inputs: ['Value'], outputs: [] },
  ];

  let connections = [];

  nodesData.forEach(({id, title, x, y, inputs, outputs}) => {
    const node = document.createElement('div');
    node.classList.add('node');
    node.style.left = x + 'px';
    node.style.top = y + 'px';
    node.id = id;

    const header = document.createElement('div');
    header.classList.add('node-header');
    header.textContent = title;
    node.appendChild(header);

    inputs.forEach(input => {
      const inputDiv = document.createElement('div');
      inputDiv.classList.add('node-input');
      inputDiv.textContent = input;
      node.appendChild(inputDiv);
    });

    outputs.forEach(output => {
      const outputDiv = document.createElement('div');
      outputDiv.classList.add('node-output');
      outputDiv.textContent = output;
      node.appendChild(outputDiv);
    });

    // Drag functionality
    let dragOffsetX = 0, dragOffsetY = 0, dragging = false;

    header.addEventListener('mousedown', e => {
      dragging = true;
      dragOffsetX = e.clientX - node.offsetLeft;
      dragOffsetY = e.clientY - node.offsetTop;
      header.style.cursor = 'grabbing';
      printLog(`Started dragging node "${title}"`);
      e.preventDefault(); // чтобы не выделялся текст
    });

    window.addEventListener('mouseup', () => {
      if(dragging) {
        printLog(`Stopped dragging node "${title}"`);
      }
      dragging = false;
      header.style.cursor = 'grab';
    });

    window.addEventListener('mousemove', e => {
      if (!dragging) return;
      node.style.left = (e.clientX - dragOffsetX) + 'px';
      node.style.top = (e.clientY - dragOffsetY) + 'px';
      updateConnections();
    });

    editor.appendChild(node);
  });

  const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
  editor.appendChild(svg);

  function updateConnections() {
    svg.innerHTML = '';
    connections = [
      { fromId: 'node1', fromOutputIndex: 0, toId: 'node2', toInputIndex: 0 },
      { fromId: 'node2', fromOutputIndex: 0, toId: 'node3', toInputIndex: 0 },
    ];

    connections.forEach(({fromId, fromOutputIndex, toId, toInputIndex}) => {
      const fromNode = document.getElementById(fromId);
      const toNode = document.getElementById(toId);

      const fromOutputs = fromNode.querySelectorAll('.node-output');
      const toInputs = toNode.querySelectorAll('.node-input');

      const fromElem = fromOutputs[fromOutputIndex];
      const toElem = toInputs[toInputIndex];

      if (!fromElem || !toElem) return;

      const fromRect = fromElem.getBoundingClientRect();
      const toRect = toElem.getBoundingClientRect();
      const editorRect = editor.getBoundingClientRect();

      const startX = fromRect.right - editorRect.left;
      const startY = fromRect.top + fromRect.height / 2 - editorRect.top;

      const endX = toRect.left - editorRect.left;
      const endY = toRect.top + toRect.height / 2 - editorRect.top;

      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("stroke", "#00ffff");
      path.setAttribute("stroke-width", "2");
      path.setAttribute("fill", "none");

      const controlX = (startX + endX) / 2;
      const d = `M${startX},${startY} C${controlX},${startY} ${controlX},${endY} ${endX},${endY}`;
      path.setAttribute("d", d);

      svg.appendChild(path);
    });
  }

  updateConnections();
</script>

</body>
</html>
